{
  "name": "JML-001-Joiner-Onboarding-Workflow",
  "description": "Automated new employee onboarding workflow with role-based application assignments",
  "version": "1.0.0",
  "author": "Isaiah Herard",
  "trigger": {
    "type": "user.lifecycle.create",
    "description": "Triggers when a new user is created in Okta",
    "filters": [
      {
        "field": "user.status",
        "operator": "equals",
        "value": "PROVISIONED"
      }
    ]
  },
  "flow": {
    "steps": [
      {
        "id": "step_1",
        "name": "Read User Profile",
        "type": "okta.user.read",
        "description": "Retrieve the new user's profile information",
        "inputs": {
          "user_id": "{{trigger.user.id}}"
        },
        "outputs": {
          "user": "user_profile"
        }
      },
      {
        "id": "step_2",
        "name": "Determine Department Group",
        "type": "conditional.branch",
        "description": "Route user to appropriate department workflow",
        "inputs": {
          "condition_field": "{{user_profile.profile.department}}"
        },
        "branches": [
          {
            "condition": "equals",
            "value": "Engineering",
            "next_step": "step_3a"
          },
          {
            "condition": "equals",
            "value": "Finance",
            "next_step": "step_3b"
          },
          {
            "condition": "equals",
            "value": "Human Resources",
            "next_step": "step_3c"
          },
          {
            "condition": "equals",
            "value": "Sales",
            "next_step": "step_3d"
          },
          {
            "condition": "equals",
            "value": "IT",
            "next_step": "step_3e"
          },
          {
            "condition": "default",
            "next_step": "step_3f"
          }
        ]
      },
      {
        "id": "step_3a",
        "name": "Engineering Applications",
        "type": "okta.app.assign.bulk",
        "description": "Assign engineering-specific applications",
        "inputs": {
          "user_id": "{{trigger.user.id}}",
          "applications": [
            {"app_id": "0oa1234567890abcdef", "app_name": "GitHub Enterprise"},
            {"app_id": "0oa2345678901bcdefg", "app_name": "Jira"},
            {"app_id": "0oa3456789012cdefgh", "app_name": "Confluence"},
            {"app_id": "0oa4567890123defghi", "app_name": "AWS SSO"},
            {"app_id": "0oa5678901234efghij", "app_name": "Datadog"},
            {"app_id": "0oa6789012345fghijk", "app_name": "PagerDuty"}
          ]
        },
        "next_step": "step_4"
      },
      {
        "id": "step_3b",
        "name": "Finance Applications",
        "type": "okta.app.assign.bulk",
        "description": "Assign finance-specific applications",
        "inputs": {
          "user_id": "{{trigger.user.id}}",
          "applications": [
            {"app_id": "0oa7890123456ghijkl", "app_name": "NetSuite"},
            {"app_id": "0oa8901234567hijklm", "app_name": "Concur"},
            {"app_id": "0oa9012345678ijklmn", "app_name": "Tableau"},
            {"app_id": "0oaa123456789jklmno", "app_name": "Coupa"},
            {"app_id": "0oab234567890klmnop", "app_name": "BlackLine"}
          ]
        },
        "next_step": "step_4"
      },
      {
        "id": "step_3c",
        "name": "HR Applications",
        "type": "okta.app.assign.bulk",
        "description": "Assign HR-specific applications",
        "inputs": {
          "user_id": "{{trigger.user.id}}",
          "applications": [
            {"app_id": "0oac345678901lmnopq", "app_name": "Workday"},
            {"app_id": "0oad456789012mnopqr", "app_name": "BambooHR"},
            {"app_id": "0oae567890123nopqrs", "app_name": "Greenhouse"},
            {"app_id": "0oaf678901234opqrst", "app_name": "Culture Amp"}
          ]
        },
        "next_step": "step_4"
      },
      {
        "id": "step_3d",
        "name": "Sales Applications",
        "type": "okta.app.assign.bulk",
        "description": "Assign sales-specific applications",
        "inputs": {
          "user_id": "{{trigger.user.id}}",
          "applications": [
            {"app_id": "0oag789012345pqrstu", "app_name": "Salesforce"},
            {"app_id": "0oah890123456qrstuv", "app_name": "HubSpot"},
            {"app_id": "0oai901234567rstuvw", "app_name": "Outreach"},
            {"app_id": "0oaj012345678stuvwx", "app_name": "Gong"},
            {"app_id": "0oak123456789tuvwxy", "app_name": "LinkedIn Sales Navigator"}
          ]
        },
        "next_step": "step_4"
      },
      {
        "id": "step_3e",
        "name": "IT Applications",
        "type": "okta.app.assign.bulk",
        "description": "Assign IT-specific applications",
        "inputs": {
          "user_id": "{{trigger.user.id}}",
          "applications": [
            {"app_id": "0oal234567890uvwxyz", "app_name": "ServiceNow"},
            {"app_id": "0oam345678901vwxyza", "app_name": "CyberArk PVWA"},
            {"app_id": "0oan456789012wxyZab", "app_name": "Splunk"},
            {"app_id": "0oao567890123xyzabc", "app_name": "Azure Portal"},
            {"app_id": "0oap678901234yzabcd", "app_name": "AWS Console"}
          ]
        },
        "next_step": "step_4"
      },
      {
        "id": "step_3f",
        "name": "Default Applications",
        "type": "okta.app.assign.bulk",
        "description": "Assign standard birthright applications",
        "inputs": {
          "user_id": "{{trigger.user.id}}",
          "applications": [
            {"app_id": "0oaq789012345zabcde", "app_name": "Microsoft 365"},
            {"app_id": "0oar890123456abcdef", "app_name": "Slack"},
            {"app_id": "0oas901234567bcdefg", "app_name": "Zoom"}
          ]
        },
        "next_step": "step_4"
      },
      {
        "id": "step_4",
        "name": "Assign Birthright Applications",
        "type": "okta.app.assign.bulk",
        "description": "Assign universal applications for all employees",
        "inputs": {
          "user_id": "{{trigger.user.id}}",
          "applications": [
            {"app_id": "0oat012345678cdefgh", "app_name": "Microsoft 365"},
            {"app_id": "0oau123456789defghi", "app_name": "Slack"},
            {"app_id": "0oav234567890efghij", "app_name": "Zoom"},
            {"app_id": "0oaw345678901fghijk", "app_name": "Company Intranet"}
          ]
        },
        "next_step": "step_5"
      },
      {
        "id": "step_5",
        "name": "Add to Department Group",
        "type": "okta.group.addUser",
        "description": "Add user to their department group",
        "inputs": {
          "user_id": "{{trigger.user.id}}",
          "group_name": "{{user_profile.profile.department}}-Users"
        },
        "next_step": "step_6"
      },
      {
        "id": "step_6",
        "name": "Add to Location Group",
        "type": "okta.group.addUser",
        "description": "Add user to their location group",
        "inputs": {
          "user_id": "{{trigger.user.id}}",
          "group_name": "Location-{{user_profile.profile.city}}"
        },
        "next_step": "step_7"
      },
      {
        "id": "step_7",
        "name": "Send Welcome Email",
        "type": "email.send",
        "description": "Send welcome email with onboarding instructions",
        "inputs": {
          "to": "{{user_profile.profile.email}}",
          "cc": "{{user_profile.profile.managerId}}",
          "subject": "Welcome to the Company - Your Access is Ready!",
          "template": "welcome_email_template",
          "variables": {
            "first_name": "{{user_profile.profile.firstName}}",
            "department": "{{user_profile.profile.department}}",
            "start_date": "{{user_profile.profile.startDate}}",
            "manager_name": "{{user_profile.profile.manager}}"
          }
        },
        "next_step": "step_8"
      },
      {
        "id": "step_8",
        "name": "Create ServiceNow Ticket",
        "type": "servicenow.incident.create",
        "description": "Create IT ticket for hardware provisioning",
        "inputs": {
          "short_description": "New Employee Hardware Setup - {{user_profile.profile.displayName}}",
          "description": "Please provision hardware for new employee:\n\nName: {{user_profile.profile.displayName}}\nDepartment: {{user_profile.profile.department}}\nTitle: {{user_profile.profile.title}}\nStart Date: {{user_profile.profile.startDate}}\nLocation: {{user_profile.profile.city}}\nManager: {{user_profile.profile.manager}}",
          "category": "Hardware",
          "priority": "3",
          "assigned_group": "IT-Hardware-Team"
        },
        "next_step": "step_9"
      },
      {
        "id": "step_9",
        "name": "Notify Manager via Slack",
        "type": "slack.message.send",
        "description": "Notify manager that new employee has been onboarded",
        "inputs": {
          "channel": "#it-onboarding",
          "message": ":wave: *New Employee Onboarded*\n\n*Name:* {{user_profile.profile.displayName}}\n*Department:* {{user_profile.profile.department}}\n*Title:* {{user_profile.profile.title}}\n*Manager:* {{user_profile.profile.manager}}\n*Applications Assigned:* Department-specific + Birthright apps\n\n_User is ready to access company systems!_"
        },
        "next_step": "step_10"
      },
      {
        "id": "step_10",
        "name": "Log Onboarding Event",
        "type": "table.record.create",
        "description": "Log the onboarding event for audit purposes",
        "inputs": {
          "table_id": "onboarding_audit_log",
          "record": {
            "user_id": "{{trigger.user.id}}",
            "user_email": "{{user_profile.profile.email}}",
            "department": "{{user_profile.profile.department}}",
            "onboarding_timestamp": "{{now}}",
            "workflow_version": "1.0.0",
            "status": "completed"
          }
        }
      }
    ]
  },
  "error_handling": {
    "on_error": {
      "type": "notification",
      "channels": ["slack", "email"],
      "recipients": ["it-iam-team@company.com", "#iam-alerts"],
      "message": "Joiner workflow failed for user {{trigger.user.id}}: {{error.message}}"
    },
    "retry": {
      "enabled": true,
      "max_attempts": 3,
      "delay_seconds": 60
    }
  },
  "metadata": {
    "created_date": "2024-01-15",
    "last_modified": "2024-01-15",
    "owner": "IAM Team",
    "tags": ["joiner", "onboarding", "lifecycle", "automation"]
  }
}
